generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Sex {
  male
  female
  other
}

model Patient {
  patientId        String   @id
  title            String?
  lastName         String
  firstName        String
  sex              Sex
  birthDate        DateTime
  birthPlace       String?
  insuranceNum     String?
  phone            String?
  email            String?
  country          String?
  isForeignAddress Boolean  @default(false)
  zipCode          String?
  city             String?
  street           String?
  patientType      String?
  notes            String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  isArchived       Boolean  @default(false)

  quotes    Quote[]
  snapshots DentalStatusSnapshot[]
}

model Quote {
  quoteId            String   @id
  patientId          String
  quoteStatus        String
  createdAt          DateTime @default(now())
  lastStatusChangeAt DateTime
  isDeleted          Boolean  @default(false)
  data               Json

  patient Patient @relation(fields: [patientId], references: [patientId])

  @@index([patientId])
}

model DentalStatusSnapshot {
  snapshotId String   @id
  patientId  String
  takenAt    DateTime
  note       String?
  teeth      Json
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  patient Patient @relation(fields: [patientId], references: [patientId])

  @@index([patientId])
  @@index([takenAt])
}

model CatalogItem {
  catalogItemId         String  @id
  catalogCode           String
  catalogName           String
  catalogUnit           String
  catalogPrice          Float
  catalogPriceCurrency  String
  catalogVatRate        Float
  catalogTechnicalPrice Float
  catalogCategory       String
  hasTechnicalPrice     Boolean @default(false)
  isFullMouth           Boolean @default(false)
  isArch                Boolean @default(false)
  isActive              Boolean @default(true)
}

model AppSettings {
  id        String   @id
  data      Json
  updatedAt DateTime @updatedAt
}

model Invoice {
  id        String   @id
  patientId String
  quoteId   String
  status    String
  createdAt DateTime
  data      Json

  @@index([patientId])
  @@index([quoteId])
}

model NeakCheck {
  id        String   @id
  patientId String
  checkedAt DateTime
  data      Json

  @@index([patientId])
  @@index([checkedAt])
}

model OdontogramCurrent {
  patientId String   @id
  updatedAt DateTime
  data      Json
}

model OdontogramDaily {
  patientId String
  dateKey   String
  updatedAt DateTime
  data      Json

  @@id([patientId, dateKey])
  @@index([patientId])
}

model OdontogramTimeline {
  snapshotId String   @id
  patientId  String
  updatedAt  DateTime
  data       Json

  @@index([patientId])
  @@index([updatedAt])
}
